package br.org.funcate.glue.view;

import javax.swing.JPanel;
import java.awt.Color;
import javax.swing.border.LineBorder;
import javax.swing.DefaultListModel;
import javax.swing.JLabel;
import javax.swing.JTextField;
import javax.swing.JButton;
import java.awt.Font;
import javax.swing.event.CaretListener;
import javax.swing.event.CaretEvent;

import br.org.funcate.glue.controller.InfoToolController;
import br.org.funcate.glue.main.AppSingleton;
import br.org.funcate.glue.model.canvas.CanvasState;
import br.org.funcate.glue.model.canvas.InfoToolService;
import br.org.funcate.glue.model.canvas.ThemeAttributesInfoTool;
import br.org.funcate.glue.model.exception.GlueServerException;
import br.org.funcate.glue.service.TerraJavaClient;

import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.util.List;
import javax.swing.JList;
import javax.swing.JScrollPane;
import javax.swing.ImageIcon;

public class SearchPanel extends JPanel {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private JTextField textSearch;
	private JButton btnSearch;
	private JList<String> list;
	private DefaultListModel<String> listModel;

	/**
	 * Create the panel.
	 */
	public SearchPanel() {
		setBorder(new LineBorder(new Color(192, 192, 192)));
		setBackground(new Color(255, 255, 255));
		setLayout(null);
		
		textSearch = new JTextField();
		textSearch.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseReleased(MouseEvent arg0) {
//				AppSingleton singleton = AppSingleton.getInstance();
//				CanvasState state = singleton.getCanvasState();
//				int center = ((state.getCanvasWidth())/2);
				setBounds(200,80,560,60);
			}
		});
		
		textSearch.setForeground(new Color(128, 128, 128));
		textSearch.setBorder(new LineBorder(new Color(192, 192, 192)));
		textSearch.setFont(new Font("SansSerif", Font.PLAIN, 16));
		textSearch.setBounds(10, 11, 430, 34);
		add(textSearch);
		textSearch.setColumns(10);
		
		btnSearch = new JButton("Pesquisar");
		btnSearch.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				listModel = new DefaultListModel<String>();
				
				try {
					String[] coords = textSearch.getText().split(",");
					List<ThemeAttributesInfoTool> res = InfoToolService.getInfoByClick(Double.parseDouble(coords[1]),Double.parseDouble(coords[0]));
//					AppSingleton singleton = AppSingleton.getInstance();
//					CanvasState state = singleton.getCanvasState();
//					int center = ((state.getCanvasWidth())/2);
					setBounds(200,80,560,180);
					//TerraJavaClient service = AppSingleton.getInstance().getServices();
					//System.out.println(res.get(0).getAttributes().get(3));
					listModel.clear();
					for (int i = 0; i < res.size(); i++) {
						listModel.addElement(res.get(i).getAttributes().get(3).toString());
					}
					list.setModel(listModel);
					
				} catch (GlueServerException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		});
		btnSearch.setBorder(null);
		btnSearch.setForeground(new Color(255, 255, 255));
		btnSearch.setBackground(new Color(95, 158, 160));
		btnSearch.setFont(new Font("SansSerif", Font.BOLD, 14));
		btnSearch.setBounds(440, 8, 102, 40);
		add(btnSearch);
		
		JScrollPane scrollPane = new JScrollPane();
		scrollPane.setBorder(null);
		scrollPane.setBounds(10, 66, 430, 100);
		add(scrollPane);
		
		list = new JList<String>();
		list.setFont(new Font("SansSerif", Font.ITALIC, 14));
		list.setBorder(null);
		scrollPane.setViewportView(list);

	}

	public JTextField getTextSearch() {
		return textSearch;
	}

	public void setTextSearch(JTextField textSearch) {
		this.textSearch = textSearch;
	}

	public JButton getBtnSearch() {
		return btnSearch;
	}

	public void setBtnSearch(JButton btnSearch) {
		this.btnSearch = btnSearch;
	}
}
